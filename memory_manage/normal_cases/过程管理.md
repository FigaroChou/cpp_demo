# 第二章 内存管理

文档用于记录过程脉络，便于日后查阅。
不涉及具体的细节，只记录大致的思路。
例如：
- 关于概念知识，不介绍，只说明知识点的顺序。
- 关于代码案例，只描述思路。

## 一、 C/C++ 通用的内存管理方式
- C: malloc free realloc
- C++: new delete delete []

### 1.1 区别
- 类型安全
- 异常处理
- 内存初始化

### 1.2 案例
- 动态数组。使用 realloc 扩容。

#### 1.2.1 简易内存池
功能概览：
- 不使用模板，不涉及泛型编程。
- 为了演示，不考虑线程安全。

**池化思想**：封装创建耗时以及可复用的资源
设计思路：
- 数据结构：采用栈结构管理。FILO
- 线程安全：由业务处理。[共享 -> 读/写 -> 竞态 -> 原子性/可见性{乐/悲观锁/volatile}]
- 异常处理：抛出异常，不以返回值标识状态。
- 内存初始化：由业务处理。
- 内存生命周期：RAII。
- 预分配方式：非连续内存，采用离散方式。
- 扩容：预先分配，不扩容。扩容需考虑峰值时的高频扩容情况，根据扩容规则，可能导致指数级的增长，但实际应用中，峰值过后，内存使用量会回落，导致严重的内存泄漏。